;식사를 권한다
@COM415
LOCAL = RAND:100
LOCAL:1 = 90 + GET_SUCCESS_RATE() / 5
SIF LOCAL:1 > 99
	LOCAL:1 = 99
IF LOCAL <= 9
	;10％で大成功
	EXP:MASTER:대화경험 ++
	TFLAG:SELECTCOM분기 = 1
ELSEIF LOCAL >= LOCAL:1
	;10～1％で失敗
	TFLAG:SELECTCOM분기 = -1
ELSE
	;残りは成功
	TFLAG:SELECTCOM분기 = 0
ENDIF
;先制発生時は失敗しない
SIF TCVAR:TARGET:20
	TFLAG:SELECTCOM분기 = MAX(TFLAG:SELECTCOM분기,0)

DOWNBASE:MASTER:기력 += 100
DOWNBASE:MASTER:체력 += 50

	;その場に居るTARGET全員で回す
	LOCAL:1 = TARGET
	FOR LOCAL,1,CHARANUM
		SIF TARGET:LOCAL <= 0
			CONTINUE
		SIF CFLAG:(TARGET:LOCAL):수면
			CONTINUE
		TARGET = TARGET:LOCAL
		CALL COM415_1
	NEXT
	TARGET = LOCAL:1

TIME += 60
TCVAR:MASTER:305 = 0
TCVAR:MASTER:306 = 0
RETURN 1

@COM415_1

DOWNBASE:기력 += 10

;固定で획득するソース
SELECTCASE TCVAR:MASTER:306
	CASE 0
		CALL SOURCE_CALC_환락(TARGET, MASTER, 500)
		CALL SOURCE_CALC_정복(TARGET, MASTER, 300)
	CASE 1
		CALL SOURCE_CALC_환락(TARGET, MASTER, 300)
		CALL SOURCE_CALC_정복(TARGET, MASTER, 300)
	CASE 2
		CALL SOURCE_CALC_환락(TARGET, MASTER, 100)
		CALL SOURCE_CALC_불결(TARGET, MASTER, 600)
ENDSELECT


IF FLAG:20 < 10
	BASE:체력 = MIN(BASE:체력 + MAXBASE:체력 / 20 , MAXBASE:체력)
	BASE:기력 = MIN(BASE:기력 + MAXBASE:기력 / 5 , MAXBASE:기력)
	TCVAR:304 |= 1
ELSEIF FLAG:20 >= 10 && FLAG:20 < 20
	BASE:체력 = MIN(BASE:체력 + MAXBASE:체력 / 10 , MAXBASE:체력)
	BASE:기력 = MIN(BASE:기력 + MAXBASE:기력 / 3 , MAXBASE:기력)
	TCVAR:304 |= 2
ELSEIF FLAG:20 >= 50 && FLAG:20 < 60
	BASE:체력 = MIN(BASE:체력 + MAXBASE:체력 / 15 , MAXBASE:체력)
	BASE:기력 = MIN(BASE:기력 + MAXBASE:기력 / 2 , MAXBASE:기력)
	TCVAR:304 |= 4
ENDIF
