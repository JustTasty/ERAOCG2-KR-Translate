@CARD_EROTICS(カードID,決闘者,正規起動)
#DIMS DYNAMIC 決闘者
#DIM DYNAMIC カードID
#DIM DYNAMIC 確認カードID
#DIM DYNAMIC キャラ_ID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 正規起動
VARSET RESULT


TRYCALLFORM CARD_{カードID}("連動ID")
SIF RESULT > 0
	カードID = RESULT

SELECTCASE カードID
	;儚幻の花嫁リース→イヴリース
	CASE 52053
		確認カードID = 1872
	;マナドゥム・トリロスークタ
	CASE 54661
		確認カードID = 1950
	;No.29 マネキンキャット
	CASE 58029
		確認カードID = 1115
	;クラヴィス
	CASE 50501,52305,52306,52505,54566,55504,57552
		確認カードID = 1646

	;ブラマジガール.zin
	CASE 39820
		確認カードID = 1000
	;ラビュリンス.zin
	CASE 39821
		確認カードID = 2110
	;マスカレーナ.zin
	CASE 39822
		確認カードID = 1335
	;レイちゃん.zin
	CASE 39823
		確認カードID = 2000
	;ガガガガール.zin
	CASE 39824
		確認カードID = 1110

	;影霊獣使い－セフィラウェンディ
	CASE 33255
		確認カードID = 1821
	;ミドラーシュ
	CASE 11830, 59530
		確認カードID = 1830
	;アプカローネ
	CASE 11831, 59531
		確認カードID = 1831
	;エルシャドール・ネフィリムは巨人サイズにつき対応しない
	;CASE 41832, 59532
	;	確認カードID = 1832
	;ウェンディゴ
	CASE 11833, 41833 , 59533
		確認カードID = 1833

	;謎のレウスハンターさん
	CASE 36650
		IF 決闘者 == "自分"
			確認カードID = MASTER
		ELSE
			確認カードID = OPPOSER
		ENDIF

	;"ネガスター ウィンダ"
	CASE 59555
		確認カードID = 1815
	;"ネガスター カーム"
	CASE 59556
		確認カードID = 1816
	;"Anスフィアード ネガスター"
	CASE 59557
		確認カードID = 1817
	;ネガスター ピリカ／アヌスフィア NpNpピリカ
	CASE 59554,59558
		確認カードID = 1818

	;パンドラ・マジシャン・ガール
	CASE 59591,59592,59593
		確認カードID = 1669
	;マインドジャック・キャスリン
	CASE 59640
		確認カードID = 1655
		
	;カズーラ
	CASE 39570
		確認カードID = 1373
	;ジーナ
	CASE 39571
		確認カードID = 1379
	;ティオ
	CASE 39572
		確認カードID = 1375
	;リセ
	CASE 39573
		確認カードID = 1378
	;プティカ
	CASE 39574
		確認カードID = 1381
	;セラ
	CASE 59810
		確認カードID = 1370
	;クラリア
	CASE 59811
		確認カードID = 1380
	;フレシア
	CASE 59812
		確認カードID = 1371
	;シトリス
	CASE 59813
		確認カードID = 1385
	;ホールティア
	CASE 99821
		確認カードID = 1383

	;伊吹翼
	CASE 51842,51844
		確認カードID = 4642
	;七尾百合子
	CASE 51840,51845
		確認カードID = 4640
	;高坂海美
	CASE 51841,51843
		確認カードID = 4641

	;ドドレミアイドル・キューティア
	CASE 39686
		確認カードID = 2086
	;レドレミアイドル・ドリーミア
	CASE 39687
		確認カードID = 2087
	;ミドレミアイドル・エリーティア
	CASE 39688
		確認カードID = 2088
	;ファドレミアイドル・ファンシア
	CASE 39689
		確認カードID = 2089
	;ソドレミアイドル・グレーシア
	CASE 39690
		確認カードID = 2090
	;ラドレミアイドル・エンジェリア
	CASE 39691
		確認カードID = 2091
	;シドレミアイドル・ビューティア
	CASE 39692
		確認カードID = 2092
	;傾世ドレミアイドル・ミューゼシア
	CASE 59884
		確認カードID = 2093
	;傾世ドレミアイドル・クーリア
	CASE 59885
		確認カードID = 2085


	CASE MASTER補助, 9990
		確認カードID = MASTER
	CASE 相手プレイヤー
		IF 決闘者 == "自分"
			RETURN OPPOSER
		ELSE
			RETURN MASTER
		ENDIF
		RETURN -1
	CASEELSE
		確認カードID = カードID
ENDSELECT

VARSET キャラ_ID, -1
FOR カウンタ,1,CHARANUM
	IF NO:カウンタ == 確認カードID
		キャラ_ID = カウンタ
		RETURN キャラ_ID
	ENDIF
NEXT

IF 確認カードID > 10000 && 確認カードID < 19999
	FOR カウンタ,1,CHARANUM
		IF NO:カウンタ == (確認カードID - 10000)
			キャラ_ID = カウンタ
			RETURN キャラ_ID
		ENDIF
	NEXT
ELSEIF 確認カードID > 40000 && 確認カードID < 49999
	FOR カウンタ,1,CHARANUM
		IF NO:カウンタ == (確認カードID - 40000)
			キャラ_ID = カウンタ
			RETURN キャラ_ID
		ENDIF
	NEXT
ENDIF
RETURN -1



@FIND_CHARA_GID(キャラ_ID,CNT設定)
#DIMS DYNAMIC 決闘者
#DIM DYNAMIC カードID
#DIM DYNAMIC 確認カードID
#DIM DYNAMIC キャラ_ID
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 正規起動
#DIM DYNAMIC CNT設定
#DIM DYNAMIC 条件合致数
#DIM DYNAMIC 条件合致ID,100

;【条件達成０】そのカード_IDがあるなら返す
カードID = NO:キャラ_ID
IF ENUMFILES("RESOURCES/DUEL", @"{カードID}_DUEL.*")
	IF CNT設定 == 1
		条件合致ID:条件合致数 = カードID
		条件合致数 ++
	ELSE
		RETURN カードID
	ENDIF
ENDIF


;＞＞　第１チェック、強化版カード　＜───────────────────────────────────
;+10000のカードが会ったら次のチェック
カードID = NO:キャラ_ID + 10000
TRYCALLFORM CARDNAME_{カードID}, "名前"
SIF RESULTS == ""
	GOTO CHECK_2

;カードIDのキャラとキャラIDが違うならNG
CALL CARD_EROTICS(カードID)
SIF RESULT != キャラ_ID
	GOTO CHECK_2

;【条件達成１】そのカード_IDがあるなら返す
IF ENUMFILES("RESOURCES/DUEL", @"{カードID}_DUEL.*")
	IF CNT設定 == 1
		条件合致ID:条件合致数 = カードID
		条件合致数 ++
	ELSE
		RETURN カードID
	ENDIF
ENDIF

;＞＞　第２チェック、EXカード　＜─────────────────────────────────────
$CHECK_2
;+40000のカードが会ったら次のチェック
カードID = NO:キャラ_ID + 40000
TRYCALLFORM CARDNAME_{カードID}, "名前"
SIF RESULTS == ""
	GOTO CHECK_3
;カードIDのキャラとキャラIDが違うならNG
CALL CARD_EROTICS(カードID)
SIF RESULT != キャラ_ID
	GOTO CHECK_3

;【条件達成２】そのカード_IDがあるなら返す
IF ENUMFILES("RESOURCES/DUEL", @"{カードID}_DUEL.*")
	IF CNT設定 == 1
		条件合致ID:条件合致数 = カードID
		条件合致数 ++
	ELSE
		RETURN カードID
	ENDIF
ENDIF
;＞＞　第３チェック、その他カード　＜─────────────────────────────────────
;総当たり
$CHECK_3
FOR カードID,10000,70000
	VARSET RESULTS
	TRYCALLFORM CARDNAME_{カードID}, "名前"
	SIF RESULTS == ""
		CONTINUE
	SIF カードID == NO:キャラ_ID + 10000
		CONTINUE
	SIF カードID == NO:キャラ_ID + 40000
		CONTINUE
	CALL CARD_EROTICS(カードID)
	SIF RESULT != キャラ_ID
		CONTINUE
	IF ENUMFILES("RESOURCES/DUEL", @"{カードID}_DUEL.*")
		IF CNT設定 == 1
			条件合致ID:条件合致数 = カードID
			条件合致数 ++
		ELSE
			RETURN カードID
		ENDIF
	ENDIF
NEXT
IF CNT設定 == 1
	FOR カウンタ,0,10
		RESULT:(カウンタ + 1) = 条件合致ID:カウンタ
	NEXT	
	RETURN 条件合致数
ENDIF
RETURN -1

@CARD_EROTICS_FIELD(決闘者,ゾーン,場所,反転フラグ)
#DIMS DYNAMIC 決闘者
#DIMS DYNAMIC 対面者
#DIMS DYNAMIC 対象者
#DIMS DYNAMIC ゾーン
#DIM DYNAMIC 場所
#DIM DYNAMIC カード_ID
#DIM DYNAMIC 調教対象
#DIM DYNAMIC カウンタ
#DIM DYNAMIC 選択カード
#DIM DYNAMIC 効果蓄積
#DIM DYNAMIC 反転フラグ


CALL 対面者判定(決闘者)
対面者 = %RESULTS%

IF 反転フラグ == 1
	対象者 = %対面者%
ELSE
	対象者 = %決闘者%
ENDIF


IF ゾーン == "戦場"
	カード_ID = GETVAR(@"%対象者%_戦場:場所")
	IF GETVAR(@"%対象者%_MZ_変化元ID:場所") > -1
		カード_ID = GETVAR(@"%対象者%_MZ_変化元ID:場所")
	ENDIF
ELSEIF ゾーン == "魔罠"
	カード_ID = GETVAR(@"%対象者%_魔罠:場所")
ELSE
	カード_ID = GETVAR(@"%対面者%_%ゾーン%:場所")
ENDIF
CALL CARD_EROTICS(カード_ID)
RETURN RESULT