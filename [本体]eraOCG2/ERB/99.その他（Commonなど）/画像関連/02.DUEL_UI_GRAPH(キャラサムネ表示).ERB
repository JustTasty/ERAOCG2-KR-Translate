@PREPARE_DUEL_PLAYBOARD, PREPARED
#DIM DYNAMIC GDI値
#DIM SRC_WIDTH
#DIM SRC_HEIGHT
#DIM PASTE_WIDTH
#DIM PASTE_HEIGHT
#DIM PASTE_X
#DIM PASTE_Y
#DIM PREPARED
#DIM FONTSIZE
#DIM LINEHEIGHT
#DIMS HTML_TEXT
#DIMS SPRITE名

; 引数
; 	PREPARED
;		0: prepare background canva befor DUEL start, if something changed, such as OPPOSER change in Duel (乱入ペナルティ-2000), call function with 0 again.
;		1: display canvas during DUEL
;

FONTSIZE = GETCONFIG("フォントサイズ")
LINEHEIGHT = GETCONFIG("一行の高さ")

;DISPLAY_CARDS_ONBOARD default
FOR LOCAL, 0, 10
	GDI値 = 6000+LOCAL
	SPRITE名 '= @"{LOCAL}_FIELDCARD"
	SPRITEDISPOSE SPRITE名
	GDISPOSE GDI値
	GCREATEFROMFILE GDI値, "半透明黒.png"
	SPRITECREATE SPRITE名, GDI値
NEXT

; PREPARE MASTER THUMBNAIL
CALL PREPARE_DUEL_THUMBNAIL(MASTER)
GDI値 = RESULT
SRC_WIDTH = GWIDTH(GDI値)
SRC_HEIGHT = GHEIGHT(GDI値)
GDISPOSE 6020
GCREATE 6020, SRC_WIDTH, SRC_HEIGHT
GDRAWG 6020, GDI値, 0, 0, SRC_WIDTH, SRC_HEIGHT, 0, 0, SRC_WIDTH, SRC_HEIGHT

SPRITE名 '= "MASTER_THUMB"
SPRITEDISPOSE SPRITE名
SPRITECREATE SPRITE名, 6020

; PREPARE OPPOSER THUMBNAIL
CALL PREPARE_DUEL_THUMBNAIL(OPPOSER)
GDI値 = RESULT
SRC_WIDTH = GWIDTH(GDI値)
SRC_HEIGHT = GHEIGHT(GDI値)
GDISPOSE 6021
GCREATE 6021, SRC_WIDTH, SRC_HEIGHT
GDRAWG 6021, GDI値, 0, 0, SRC_WIDTH, SRC_HEIGHT, 0, 0, SRC_WIDTH, SRC_HEIGHT

SPRITE名 '= "OPPOSER_THUMB"
SPRITEDISPOSE SPRITE名
SPRITECREATE SPRITE名, 6021

RETURN 0

;サムネ画像関連（Duelの目線だけ映すやつ）
@PREPARE_DUEL_THUMBNAIL(ARG, CROP_YPOS = 30, CROP_HEIGHT = 30)
#DIM DYNAMIC GDI値
#DIM DYNAMIC GRAPH_SIZE
#DIM MASK_COLOR
#DIMS HTML_TEXT_MASTER
#DIMS HTML_TEXT_TARGET
#DIMS HTML_TEXT
#DIM FONTSIZE
#DIM LINEHEIGHT
#DIM CROP_YPOS
#DIM CROP_HEIGHT

MASK_COLOR = 0xFFFFFFFF

; 引数
; 	ARGS: MASTER, OPPOSER
; 	CROP_YPOS: reference y pos for cropping
; 	CROP_HEIGHT: height of croped image
; GDI値
; 	0:	OPPOSER, was prepared after line 58 SHOW_GRAPHICS called
; 	20:	master, prepared before DUEL start
; 	1:	mask
;   21:	cropped image
;   22: corpped image with mask

; BORDER
IF ENUMFILES("RESOURCES/WAKU", @"WAKU_BORDER_1.*")
SPLIT RESULTS, "\\", RESULTS
GCREATEFROMFILE 23, "WAKU/"+RESULTS:(RESULT-1)
SPRITECREATE @"WAKU_BORDER_1", 23
ENDIF
IF ENUMFILES("RESOURCES/WAKU", @"WAKU_BORDER_2.*")
SPLIT RESULTS, "\\", RESULTS
GCREATEFROMFILE 24, "WAKU/"+RESULTS:(RESULT-1)
SPRITECREATE @"WAKU_BORDER_2", 24
ENDIF

SPRITEDISPOSE "CROP_THUMBNAIL"
IF ARG != MASTER && ARG != -1
	; ENEMY
	GDI値 = 60
	CALL SHOW_GRAPHICS(ARG,GDI値,1)
	IF SPRITECREATED(@"{NO:ARG}_THUMB") == 0
		DEBUGPRINTFORML {NO:ARG}_THUMB not exist
		ARG = -1
	ENDIF
	GWIDTH GDI値
	GRAPH_SIZE = RESULT
	DEBUGPRINTFORML ENEMY_GRAPH   {NO:ARG}_THUMB {GRAPH_SIZE} x {GRAPH_SIZE}
	GDRAWSPRITE GDI値, @"WAKU_BORDER_2",0,0,GRAPH_SIZE,GRAPH_SIZE
ELSEIF ARG == MASTER
	; MASTER
	GDI値 = 61
	CALL SHOW_GRAPHICS(ARG,GDI値,1)
	IF SPRITECREATED(@"{NO:ARG}_THUMB") == 0
		DEBUGPRINTFORML {NO:ARG}_THUMB not exist
		ARG = -1
	ENDIF
	GWIDTH GDI値
	GRAPH_SIZE = RESULT
	DEBUGPRINTFORML ENEMY_MASTER  {NO:ARG}_THUMB {GRAPH_SIZE} x {GRAPH_SIZE}
	GDRAWSPRITE GDI値, @"WAKU_BORDER_1",0,0,GRAPH_SIZE,GRAPH_SIZE	
ELSE
	; GENERAL
	GDI値 = 60
	CALL SHOW_GRAPHICS(ARG,GDI値,1)
	IF SPRITECREATED(@"-1_THUMB") == 0
		DEBUGPRINTFORML -1_THUMB not exist
		ARG = -1
	ENDIF
	GWIDTH GDI値
	GRAPH_SIZE = RESULT
	DEBUGPRINTFORML ENEMY_GENERAL -1_THUMB {GRAPH_SIZE} x {GRAPH_SIZE}
	GDRAWSPRITE GDI値, @"WAKU_BORDER_2",0,0,GRAPH_SIZE,GRAPH_SIZE
ENDIF

IF ARG == -1 && LOCAL == 10
	;NOT EXIST OR NO FACE IMAGE
	GDISPOSE 22
	GCREATE 22, 180, 180*CROP_HEIGHT/10
	SPRITECREATE "CROP_THUMBNAIL", 22
	RETURN 22
ENDIF

GRAPH_SIZE = GWIDTH(GDI値)
SPRITECREATE "CROP_THUMBNAIL", GDI値, 0, GRAPH_SIZE*CROP_YPOS/100, GRAPH_SIZE, GRAPH_SIZE*CROP_HEIGHT/100
; CROPED
GDISPOSE 21
GCREATE 21, GRAPH_SIZE, GRAPH_SIZE*CROP_HEIGHT/100
GDRAWSPRITE 21, "CROP_THUMBNAIL"

;[SKIPSTART]
; CREATE MASK GDI = 1
GDISPOSE 1
GCREATE 1, GRAPH_SIZE, GRAPH_SIZE*CROP_HEIGHT/100
GSETBRUSH 1, MASK_COLOR
GFILLRECTANGLE 1, 0, 0, GRAPH_SIZE, GRAPH_SIZE*CROP_HEIGHT/100
;[SKIPEND]

; MASKED ON IMAGE
GDISPOSE 22
GCREATE 22, GRAPH_SIZE, GRAPH_SIZE*CROP_HEIGHT/100
GDRAWGWITHMASK 22, 21, 1, 0, 0
; RELOAD CROPPED MASKED IMAGE
SPRITEDISPOSE "CROP_THUMBNAIL"
SPRITECREATE "CROP_THUMBNAIL", 22

RETURN 22